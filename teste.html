<!DOCTYPE html>
<meta charset="utf-8">
<style>

html{
  background: #fff;
}
</style>
<body>
<script src="//d3js.org/d3.v4.min.js" charset="utf-8"></script>
<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
<script src="//d3js.org/topojson.v1.min.js"></script>
<script>

var width = 1024,
    height = 720;

var STATE = "MG";
var max = -1;
max = 0.7;

var colorRef = d3.interpolatePuBuGn;
var colorDomain;
var colorScale;
var colorStart = colorRef(0.25);
var ref = 'density';

var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height)



var path;
svg.append("g").attr("class","background");
svg.append("g").attr("class","colors");
svg.append("g").attr("class","lines");

importBackground();


function importValues(){

// d3.json(STATE+"_setor_valores.topo.json", function(error, data) {
d3.json(STATE+"_subdistrito_valores.topo.json", function(error, data) {  
  if (error) return console.error(error);

  var setores = topojson.feature(data, data.objects.color).features;
    
colorDomain = d3.scalePow().exponent(1/10).domain([0, max]).range([0.25,1]);

    svg.select("g.colors")
    .selectAll("path")
    .data(setores)
    .enter().append("path")
      .attr("fill", function(d) {console.log(d.properties[ref]); return colorRef(colorDomain(d.properties[ref])); })
      .attr("d", path);

});
}

function importBackground(){
  d3.json(STATE+"_estado_silhueta.topo.json", function(error, data) {
   if (error) return console.error(error);
    var setor = topojson.feature(data, data.objects.setor);


var projection = d3.geoMercator()
.rotate([0, 0])
// .translate([width/2, height/2])
.fitSize([width, height],setor);

path = d3.geoPath()
    .projection(projection);

        svg.select("g.background")
        .append("path")
        .datum(setor)
        .attr("fill", function(){ return colorStart;})
        .attr("d", path);

        importLines();
        importValues();
  });


}


function importLines(){

  d3.json(STATE+"_subdistrito_linhas.topo.json", function(error, data) {
    if (error) return console.error(error);

    var setor = topojson.feature(data, data.objects.subdistrito);

         svg.select("g.lines")
        .append("path")
        .datum(setor)
        .attr("fill", "none")
        .attr("stroke", "#333")
       .attr("stroke-width", 0.1)
        .attr("stroke-opacity", 0.5)
        .attr("d", path);
  });
}


</script>
